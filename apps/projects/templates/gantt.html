{% extends "base.html" %}

{% block content %}

<div style="max-width: 1000px; margin: 0 auto; padding: 32px;">
    <h2 style="font-size: 28px; font-weight: bold; color: #444; margin-bottom: 16px; text-align: center;">Project Overview</h2>

    <!-- Project Selection Dropdown -->
    <select id="project-select" style="margin-bottom: 24px; padding: 8px; width: 100%; border-radius: 8px; border: 1px solid #ccc; font-size: 16px;">
        <option value="">Select a project</option>
        {% for project in projects %}
        <option value="{{ project.id }}" {% if project.id|stringformat:"s" == request.GET.project %}selected{% endif %}>
            {{ project.name }}
        </option>
        {% endfor %}
    </select>

    <!-- Gantt Chart Container -->
    <div id="gantt-chart" style="margin-top: 24px; height: 500px; background: #f9f9f9; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);"></div>


    <script src="https://cdn.anychart.com/releases/8.10.0/js/anychart-bundle.min.js"></script>
    <script>
        document.getElementById('project-select').addEventListener('change', function() {
            const projectId = this.value;
            if (projectId) {
                window.location.href = '?project=' + projectId;
            }
        });

        // Example Data Preparation for Gantt Chart
        const tasks = [
            {% for task in tasks %}
            {
                id: "{{ task.id }}",
                name: "{{ task.name }}",
                actualStart: "{{ task.created_at|date:"Y-m-d" }}",
                actualEnd: "{{ task.deadline|date:"Y-m-d" }}"
            },
            {% endfor %}
        ];

        anychart.onDocumentReady(function() {
            const data = anychart.data.tree(tasks, "as-table");

            const chart = anychart.ganttProject();
            chart.data(data);

            // Customize task appearance
            const tasksElement = chart.getTimeline().tasks();
            tasksElement.normal().fill("#7f5af0");
            tasksElement.normal().stroke("#6246ea");

            tasksElement.selected().fill("#6246ea");
            tasksElement.selected().stroke("#7f5af0");

            // Hide progress labels or any additional unwanted labels
            tasksElement.labels(false);


            chart.container('gantt-chart');
            chart.draw();
        });
    </script>
</div>

{% endblock %}